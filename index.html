<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Розыгрыш шумоизоляции авто</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: #000000;
            color: #ffffff;
            min-height: 100vh;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0.5vh 1vw;
            overflow: hidden;
            position: relative;
            font-family: Arial, sans-serif;
        }

        .container {
            max-width: 100%;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            position: relative;
            z-index: 1;
        }

        header {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: 1vh 0;
            margin-bottom: 1vh;
            gap: 0.5vh;
            text-align: center;
        }

        .main-title {
            font-size: clamp(32px, 4vw, 64px);
            font-weight: 900;
            color: #ffffff;
            text-transform: uppercase;
            margin-bottom: 0.3vh;
            text-shadow: 2px 2px 0px #e74c3c, 4px 4px 0px #c0392b;
        }
        

        .company-name {
            font-size: clamp(28px, 3.5vw, 56px);
            font-weight: 700;
            color: #ffffff;
            letter-spacing: 0.08em;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
            margin-bottom: 0.3vh;
        }

        .prize-text {
            font-size: clamp(18px, 2vw, 32px);
            font-weight: 600;
            color: #ffffff;
            background: rgba(0, 0, 0, 0.6);
            padding: clamp(8px, 1vh, 16px) clamp(20px, 2.5vw, 40px);
            border-radius: 12px;
            border: 2px solid rgba(231, 76, 60, 0.5);
            letter-spacing: 0.05em;
        }

        .roulette-container {
            width: 100%;
            height: clamp(288px, 28.8vh, 540px);
            position: relative;
            margin: clamp(10px, 2vh, 30px) 0;
            background: linear-gradient(135deg, #1a1a1a 0%, #2a0000 100%);
            border-radius: 25px;
            border: 4px solid #e74c3c;
            box-shadow: 0 8px 30px rgba(231, 76, 60, 0.4);
            overflow: hidden;
            will-change: box-shadow;
        }
        
        .roulette-container.spinning {
            box-shadow: 0 8px 40px rgba(231, 76, 60, 0.7);
        }
        
        .roulette-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                        rgba(0,0,0,0.7) 0%, 
                        transparent 25%, 
                        transparent 75%, 
                        rgba(0,0,0,0.7) 100%);
            pointer-events: none;
            z-index: 5;
        }

        .roulette-strip {
            display: flex;
            height: 100%;
            position: absolute;
            left: 0;
            top: 0;
            will-change: transform;
            transform: translateZ(0);
        }

        .number-block {
            width: 200px;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: clamp(56px, 7vw, 110px);
            font-weight: 800;
            color: #ffffff;
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            border-right: 3px solid rgba(0, 0, 0, 0.5);
            border-left: 1px solid rgba(255, 255, 255, 0.1);
            flex-shrink: 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            position: relative;
            transform: translateZ(0);
        }

        .number-block.highlight {
            background: linear-gradient(135deg, #ffd700 0%, #ffaa00 50%, #ff8800 100%);
            transform: scale(1.08);
            z-index: 10;
            text-shadow: 0 3px 6px rgba(0, 0, 0, 0.7);
        }

        .roulette-pointer {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            height: 100%;
            width: 10px;
            background: linear-gradient(180deg, #ffffff 0%, #e74c3c 50%, #ffffff 100%);
            z-index: 10;
            box-shadow: 0 0 20px rgba(231, 76, 60, 0.8);
        }

        .roulette-pointer::before, .roulette-pointer::after {
            content: "";
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            border-left: 35px solid transparent;
            border-right: 35px solid transparent;
        }

        .roulette-pointer::before {
            top: -2px;
            border-top: 50px solid #ffffff;
        }

        .roulette-pointer::after {
            bottom: -2px;
            border-bottom: 50px solid #ffffff;
        }

        .controls {
            position: fixed;
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 5px;
            z-index: 100;
            opacity: 0.1;
            transition: opacity 0.3s ease;
            max-width: 120px;
        }
        
        .controls:hover {
            opacity: 1;
        }

        .control-group {
            background: rgba(26, 26, 26, 0.9);
            padding: 6px 8px;
            border-radius: 4px;
            border: 1px solid rgba(231, 76, 60, 0.3);
        }

        .control-title {
            font-size: 8px;
            font-weight: 600;
            margin-bottom: 4px;
            color: #ffffff;
            text-transform: uppercase;
        }

        .participants-control {
            display: flex;
            flex-direction: column;
            gap: 3px;
            margin-bottom: 4px;
            color: #ffffff;
            font-size: 8px;
        }

        .participants-control input {
            width: 50px;
            padding: 2px 4px;
            font-size: 8px;
            border: 1px solid rgba(231, 76, 60, 0.3);
            border-radius: 2px;
            text-align: center;
            background: rgba(42, 42, 42, 0.8);
            color: #ffffff;
        }

        .btn {
            padding: 3px 6px;
            font-size: 7px;
            font-weight: bold;
            background: rgba(0,0,0,0.8);
            color: white;
            border: 1px solid #e74c3c;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            text-transform: uppercase;
            margin-bottom: 2px;
        }

        .btn:hover {
            background: #e74c3c;
        }

        .btn:disabled {
            background: rgba(60,60,60,0.6);
            border-color: rgba(231,76,60,0.3);
            opacity: 0.6;
        }

        footer {
            position: fixed;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            color: #666;
            font-size: 13px;
            opacity: 0.4;
            z-index: 1;
        }

        .timer-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: clamp(15px, 3vh, 50px) 0;
            width: 100%;
            position: relative;
        }

        .timer-title {
            display: none; /* Скрыт по требованию */
        }

        .timer-display {
            font-size: clamp(120px, 18vw, 480px);
            font-weight: 900;
            color: #ffffff;
            text-shadow: 0 0 80px rgba(231, 76, 60, 1),
                         0 0 160px rgba(231, 76, 60, 0.8),
                         0 0 240px rgba(231, 76, 60, 0.6);
            height: clamp(130px, 20vh, 500px);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0;
            position: relative;
            will-change: transform;
        }
        
        .timer-display.tick-animation {
            animation: timerTick 0.4s ease-out;
        }
        
        @keyframes timerTick {
            0% { transform: scale(1); }
            30% { transform: scale(1.06); }
            100% { transform: scale(1); }
        }
        
        .timer-display.critical {
            animation: criticalPulse 0.5s ease-in-out infinite;
        }
        
        @keyframes criticalPulse {
            0%, 100% {
                transform: scale(1);
                color: #ffffff;
            }
            50% {
                transform: scale(1.05);
                color: #ff4444;
            }
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .modal-content {
            background: linear-gradient(135deg, #1a1a1a 0%, #2a0000 100%);
            padding: clamp(30px, 4vh, 80px);
            border-radius: 30px;
            text-align: center;
            position: relative;
            z-index: 1001;
            transform: scale(0.5);
            transition: transform 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            max-width: 90%;
            width: clamp(500px, 50vw, 1000px);
            border: 4px solid #e74c3c;
            box-shadow: 0 10px 50px rgba(231, 76, 60, 0.5);
            overflow: hidden;
        }

        .modal-overlay.active .modal-content {
            transform: scale(1);
        }

        .modal-title {
            font-size: clamp(28px, 3.5vw, 72px);
            color: #ffffff;
            font-weight: 700;
            margin-bottom: 15px;
            letter-spacing: 3px;
            text-shadow: 0 0 20px rgba(231, 76, 60, 0.8);
        }

        .modal-winner {
            font-size: clamp(100px, 12vw, 320px);
            font-weight: 900;
            color: #ffffff;
            margin: 20px 0;
            text-shadow: 0 0 40px rgba(231, 76, 60, 0.8),
                         0 0 80px rgba(231, 76, 60, 0.5);
            position: relative;
            z-index: 1;
        }

        .modal-subtitle {
            font-size: clamp(20px, 2.5vw, 52px);
            color: #ffffff;
            font-weight: 600;
            margin-bottom: 25px;
        }

        .modal-btn {
            padding: clamp(12px, 1.5vh, 24px) clamp(30px, 4vw, 70px);
            font-size: clamp(16px, 2vw, 36px);
            font-weight: bold;
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-btn:hover {
            background: linear-gradient(135deg, #ff6b5a 0%, #e74c3c 100%);
            transform: translateY(-2px);
        }

        .confetti {
            position: fixed;
            pointer-events: none;
            z-index: 1002;
            will-change: transform, opacity;
        }


        .firework-particle {
            position: fixed;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 1003;
            box-shadow: 0 0 10px rgba(255,255,255,0.6);
            will-change: transform, opacity;
        }

        .winners-panel {
            position: fixed;
            top: 20%;
            left: 15px;
            transform: translateY(0);
            background: transparent;
            padding: 15px;
            max-width: 350px;
            min-width: 300px;
            opacity: 0.7;
            transition: opacity 0.3s ease;
            z-index: 80;
        }

        .winners-panel:hover {
            opacity: 1;
            border-color: rgba(231, 76, 60, 0.6);
        }

        .winners-title {
            font-size: 32px !important;
            font-weight: 900 !important;
            color: #ffffff !important;
            text-transform: uppercase;
            margin-bottom: 15px !important;
            text-align: left;
            letter-spacing: 2px;
            white-space: nowrap;
        }

        .winner-item {
            display: flex;
            align-items: center;
            padding: 8px 0 !important;
            font-size: 28px !important;
            color: #ffffff !important;
            justify-content: flex-start;
            font-weight: 700 !important;
        }

        .winner-item:last-child {
            border-bottom: none;
        }

        .winner-text {
            color: #ffffff !important;
            font-size: 28px !important;
            line-height: 1.5;
            font-weight: 700 !important;
        }

        .winner-number {
            font-weight: 900 !important;
            color: #ffd700 !important;
            margin-left: 8px;
            font-size: 32px !important;
        }

        /* Оптимизация для телевизоров и больших экранов */
        @media (min-width: 1200px) {
            body { 
                padding: 0.5vh 1vw; 
                font-size: 16px;
            }
            
            .main-title { 
                font-size: clamp(36px, 4vw, 64px); 
                margin-bottom: 0.3vh;
            }
            
            .company-name { 
                font-size: clamp(20px, 2.5vw, 40px); 
                margin-bottom: 0.2vh;
            }
            
            .prize-text { 
                font-size: clamp(14px, 1.5vw, 24px); 
                padding: clamp(6px, 0.8vh, 12px) clamp(16px, 2vw, 32px);
            }
            
            .timer-display { 
                font-size: clamp(80px, 10vw, 180px); 
                height: clamp(90px, 12vh, 200px);
            }
            
            .timer-container { 
                margin: clamp(8px, 1.5vh, 20px) 0; 
            }
            
            .roulette-container { 
                height: clamp(100px, 10vh, 160px) !important; 
                margin: clamp(3px, 0.5vh, 8px) 0;
            }
            
            .number-block { 
                width: clamp(80px, 8vw, 120px) !important; 
                font-size: clamp(18px, 2vw, 32px) !important;
            }
            
            .modal-title { font-size: clamp(24px, 3vw, 40px); }
            .modal-winner { font-size: clamp(80px, 10vw, 160px); margin: clamp(12px, 2vh, 20px) 0; }
            .modal-subtitle { font-size: clamp(16px, 2vw, 28px); margin-bottom: clamp(12px, 2vh, 20px); }
            .modal-content { padding: clamp(20px, 3vh, 40px); width: clamp(400px, 40vw, 600px); }
            
            .controls { 
                right: clamp(15px, 2vw, 25px); 
                opacity: 0.15; 
                max-width: clamp(200px, 20vw, 250px);
            }
            
            .winners-panel {
                left: 10px !important;
                max-width: 250px !important;
                min-width: 220px !important;
                padding: 10px !important;
            }
            
            .winners-title {
                font-size: 22px !important;
                margin-bottom: 10px !important;
            }
            
            .winner-text {
                font-size: 18px !important;
            }
            
            .winner-number {
                font-size: 20px !important;
            }
            
            header { 
                margin-bottom: clamp(0.3vh, 5px, 0.8vh); 
                padding: clamp(0.3vh, 5px, 0.8vh) 0; 
            }
        }
        
        /* Дополнительная оптимизация для очень больших экранов */
        @media (min-width: 1920px) and (max-width: 2559px) {
            .main-title { font-size: clamp(48px, 3vw, 72px); }
            .company-name { font-size: clamp(24px, 2vw, 40px); }
            .timer-display { font-size: clamp(120px, 8vw, 200px); height: clamp(140px, 10vh, 220px); }
            .roulette-container { height: clamp(120px, 12vh, 180px) !important; }
            .number-block { width: clamp(90px, 6vw, 130px) !important; font-size: clamp(20px, 1.8vw, 36px) !important; }
            .modal-winner { font-size: clamp(120px, 8vw, 200px); }
            .controls { right: clamp(20px, 2vw, 30px); max-width: clamp(220px, 18vw, 280px); }
            .winners-panel { 
                left: 12px !important; 
                max-width: 280px !important;
                min-width: 240px !important;
            }
        }

        @media (min-width: 2560px) {
            .main-title { font-size: 140px; }
            .company-name { font-size: 88px; }
            .prize-text { font-size: 48px; padding: 20px 60px; }
            .roulette-container { height: clamp(140px, 8vh, 200px) !important; }
            .number-block { width: clamp(100px, 4vw, 140px) !important; font-size: clamp(22px, 1.5vw, 40px) !important; }
            .timer-display { font-size: 600px; height: 640px; }
            .modal-winner { font-size: 450px; }
            .modal-title { font-size: 110px; }
            .modal-subtitle { font-size: 72px; }
            .controls { right: 40px; max-width: 320px; opacity: 0.15; }
            .control-title { font-size: 14px; }
            .btn { font-size: 13px; padding: 8px 16px; }
            footer { font-size: 16px; }
            .winners-panel {
                left: 15px !important;
                max-width: 320px !important;
                min-width: 280px !important;
            }
        }

        @media (min-aspect-ratio: 21/9) {
            .container { max-width: 85vw; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="main-title">РОЗЫГРЫШ</div>
            <div class="company-name">StP СТАНДАРТПЛАСТ</div>
            <div class="prize-text">Главный приз: шумоизоляция дверей автомобиля</div>
        </header>

        <div class="timer-container" id="timerContainer">
            <div class="timer-display" id="timer">15</div>
        </div>

        <div class="roulette-container">
            <div class="roulette-strip" id="rouletteStrip"></div>
            <div class="roulette-pointer"></div>
        </div>
        

        <div class="winners-panel">
            <div class="winners-title">🏆 ПОБЕДИТЕЛИ:</div>
        </div>

        <div class="controls">
            <div class="control-group">
                <h2 class="control-title">👥 Управление участниками</h2>
                <div class="participants-control">
                    <label for="participantsInput">Количество:</label>
                    <input type="number" id="participantsInput" min="10" max="500" value="250">
                    <button class="btn" id="updateBtn">🔄 Обновить</button>
                </div>
                <div class="participants-control">
                    <button class="btn" id="addBtn">➕ Добавить 10</button>
                    <button class="btn" id="removeBtn">➖ Убрать 10</button>
                </div>
            </div>
            
            <div class="control-group">
                <h2 class="control-title">🎮 Управление рулеткой</h2>
                <button class="btn" id="spinBtn">▶️ Запустить рулетку</button>
                <button class="btn" id="stopBtn" style="margin-top: 12px; background: #c0392b;">⏹️ Остановить досрочно</button>
            </div>
            
            <div class="control-group">
                <h2 class="control-title">📺 Режим отображения</h2>
                <button class="btn" id="fullscreenBtn">⛶ Полный экран</button>
            </div>
        </div>

        <footer>
            <p>Розыгрыш шумоизоляции для дверей автомобиля © 2025 | Все права защищены</p>
        </footer>
    </div>

    <div class="modal-overlay" id="winnerModal">
        <div class="modal-content">
            <div class="modal-title">ПОБЕДИТЕЛЬ РОЗЫГРЫША!</div>
            <div class="modal-winner" id="modalWinnerNumber">-</div>
            <div class="modal-subtitle">Участник №<span id="modalWinnerId">0</span> выиграл шумоизоляцию дверей автомобиля</div>
            <button class="modal-btn" id="closeModalBtn">Закрыть</button>
        </div>
    </div>

    <audio id="winSound" preload="auto">
        <source src="WIN.mp3" type="audio/mpeg">
    </audio>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const rouletteStrip = document.getElementById('rouletteStrip');
            const spinBtn = document.getElementById('spinBtn');
            const stopBtn = document.getElementById('stopBtn');
             const updateBtn = document.getElementById('updateBtn');
             const addBtn = document.getElementById('addBtn');
             const removeBtn = document.getElementById('removeBtn');
             const participantsInput = document.getElementById('participantsInput');
             const timerDisplay = document.getElementById('timer');
            const timerContainer = document.getElementById('timerContainer');
            const winnerModal = document.getElementById('winnerModal');
            const modalWinnerNumber = document.getElementById('modalWinnerNumber');
            const modalWinnerId = document.getElementById('modalWinnerId');
             const closeModalBtn = document.getElementById('closeModalBtn');
             const fullscreenBtn = document.getElementById('fullscreenBtn');
             const winSound = document.getElementById('winSound');
             const winnersPanel = document.querySelector('.winners-panel');
            
             let participants = 250;
             let isSpinning = false;
             let animationId = null;
             let timerId = null;
             let spinStartTime = 0;
             const spinDuration = 15000; // 15 секунд розыгрыша
             let blockWidth = 200; // Фиксированная ширина блока
             const speedFactor = 30.0; // В 2 раза быстрее (было 15.0)
             let winner = null;
             let timeLeft = 15; // 15 секунд обратного отсчета
             let participantNumbers = [];
             let virtualPosition = 0;
             let cycleWidth = 0;
             let totalCycles = 0;
             let isSlowingDown = false;
             let winners = []; // Массив победителей
             let roundNumber = 1; // Номер текущего раунда
             
             // Адаптивная ширина блока в зависимости от размера экрана
             function updateBlockWidth() {
                 if (window.innerWidth >= 2560) {
                     blockWidth = 300;
                 } else if (window.innerWidth >= 1920) {
                     blockWidth = 220;
                 } else {
                     blockWidth = 200;
                 }
             }
            
             function initializeRoulette() {
                 updateBlockWidth(); // Обновляем ширину блока
                 rouletteStrip.innerHTML = '';
                 
                 participantNumbers = Array.from({length: participants}, (_, i) => i + 1);
                shuffleArray(participantNumbers);
                
                 // Максимальная оптимизация для телевизоров: еще меньше элементов
                 const minCycles = window.innerWidth > 1200 ? 10 : 15;
                 const maxCycles = Math.ceil(window.innerWidth > 1200 ? 1500 / participants : 2000 / participants);
                 totalCycles = Math.max(minCycles, Math.min(maxCycles, window.innerWidth > 1200 ? 20 : 25));
                
                console.log('Participants:', participants, 'Cycles:', totalCycles, 'Total elements:', participants * totalCycles);
                
                const fragment = document.createDocumentFragment();
                for (let i = 0; i < totalCycles; i++) {
                    participantNumbers.forEach(num => {
                        const block = document.createElement('div');
                        block.className = 'number-block';
                        block.textContent = num;
                        block.dataset.number = num;
                        fragment.appendChild(block);
                    });
                }
                rouletteStrip.appendChild(fragment);
                
                 cycleWidth = participants * blockWidth;
                 virtualPosition = cycleWidth * 2; // Начинаем с 2 цикла вместо 3
                 updateRoulettePosition();
                
                console.log('Cycle width:', cycleWidth, 'Initial position:', virtualPosition, 'Total width:', cycleWidth * totalCycles);
            }
            
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }
            
            function updateRoulettePosition() {
                // Умная перемотка: если приближаемся к концу, плавно перескакиваем назад
                if (!isSlowingDown && virtualPosition > cycleWidth * (totalCycles - 6)) {
                    virtualPosition -= cycleWidth * Math.floor(totalCycles / 2);
                    console.log('Rewinding to position:', virtualPosition);
                }
                rouletteStrip.style.transform = `translateX(${-virtualPosition}px)`;
            }
            
            function startSpinning() {
                if (isSpinning) return;
                
                isSpinning = true;
                spinBtn.disabled = true;
                 winner = null;
                 timeLeft = 15;
                 timerDisplay.textContent = timeLeft;
                 isSlowingDown = false;
                
                document.querySelector('.roulette-container').classList.add('spinning');
                document.querySelectorAll('.number-block.highlight').forEach(el => {
                    el.classList.remove('highlight');
                });
                
                spinStartTime = Date.now();
                startTimer();
                
                 function animate() {
                     if (!isSpinning) return;
                     
                     const elapsed = Date.now() - spinStartTime;
                     const progress = Math.min(elapsed / spinDuration, 1);
                     
                     let speed = speedFactor;
                     
                     // Более драматичное замедление для создания интриги
                     if (progress > 0.7) {
                         isSlowingDown = true;
                         // Замедление начинается раньше (70% вместо 80%)
                         const slowdownProgress = (progress - 0.7) / 0.3;
                         // Более агрессивное замедление
                         speed = speedFactor * Math.pow(1 - slowdownProgress, 3);
                         // Минимальная скорость для эффекта "ползучести"
                         speed = Math.max(speed, 0.2);
                     } else {
                         isSlowingDown = false;
                     }
                     
                     virtualPosition += speed;
                     updateRoulettePosition();
                     
                     if (elapsed >= spinDuration) {
                         stopSpinning();
                         return;
                     }
                     
                     animationId = requestAnimationFrame(animate);
                 }
                
                animate();
            }
            
            function startTimer() {
                if (timerId) clearInterval(timerId);
                
                timerId = setInterval(() => {
                    timeLeft--;
                    timerDisplay.classList.remove('tick-animation');
                    timerDisplay.classList.remove('critical');
                    void timerDisplay.offsetWidth;
                    timerDisplay.textContent = timeLeft;
                    timerDisplay.classList.add('tick-animation');
                    
                    if (timeLeft <= 5 && timeLeft > 0) {
                        setTimeout(() => {
                            timerDisplay.classList.remove('tick-animation');
                            timerDisplay.classList.add('critical');
                        }, 400);
                    }
                    
                    if (timeLeft <= 0) {
                        clearInterval(timerId);
                        timerDisplay.classList.remove('tick-animation');
                        timerDisplay.classList.remove('critical');
                    }
                }, 1000);
            }
            
            function calculateWinner() {
                const container = document.querySelector('.roulette-container');
                const containerRect = container.getBoundingClientRect();
                const containerWidth = containerRect.width;
                const centerX = containerWidth / 2;
                const blocks = Array.from(document.querySelectorAll('.number-block'));
                
                let closestBlock = null;
                let minDistance = Infinity;
                
                blocks.forEach(block => {
                    const blockRect = block.getBoundingClientRect();
                    const containerLeft = containerRect.left;
                    const blockCenterX = blockRect.left + blockRect.width / 2 - containerLeft;
                    const distance = Math.abs(blockCenterX - centerX);
                    
                    if (distance < minDistance) {
                        minDistance = distance;
                        closestBlock = block;
                    }
                });
                
                return closestBlock ? parseInt(closestBlock.dataset.number) : participantNumbers[0];
            }
            
            function stopSpinning() {
                if (!isSpinning) return;
                
                isSpinning = false;
                cancelAnimationFrame(animationId);
                spinBtn.disabled = false;
                clearInterval(timerId);
                
                document.querySelector('.roulette-container').classList.remove('spinning');
                timerDisplay.classList.remove('tick-animation');
                timerDisplay.classList.remove('critical');
                
                winner = calculateWinner();
                
                setTimeout(() => {
                    modalWinnerNumber.textContent = winner;
                    modalWinnerId.textContent = winner;
                    winnerModal.classList.add('active');
                    
                     winSound.currentTime = 0;
                     winSound.play().catch(err => {
                         console.log('Автовоспроизведение заблокировано:', err);
                     });
                     
                     createConfetti();
                     addWinnerToList(winner);
                 }, 600);
                 
                 const blocks = document.querySelectorAll('.number-block');
                 for (let block of blocks) {
                     if (parseInt(block.dataset.number) === winner) {
                         block.classList.add('highlight');
                     }
                 }
            }
            
             function createConfetti() {
                 const colors = ['#e74c3c', '#ffffff', '#f1c40f', '#ff6b5a'];
                 
                 // Количество конфетти
                 const confettiCount = 100;
                 
                 for (let i = 0; i < confettiCount; i++) {
                    setTimeout(() => {
                        const confetti = document.createElement('div');
                        confetti.className = 'confetti';
                        confetti.style.left = Math.random() * 100 + 'vw';
                        confetti.style.top = '-10px';
                        confetti.style.width = Math.random() * 10 + 6 + 'px';
                        confetti.style.height = Math.random() * 10 + 6 + 'px';
                        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                        confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                        confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                        document.body.appendChild(confetti);
                        
                        const swingAmplitude = Math.random() * 150 - 75;
                        const animation = confetti.animate([
                            { transform: `translate(0, 0) rotate(0deg)`, opacity: 1 },
                            { transform: `translate(${swingAmplitude}px, ${window.innerHeight + 20}px) rotate(${Math.random() * 720}deg)`, opacity: 0 }
                        ], {
                            duration: Math.random() * 2500 + 2500,
                            easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
                        });
                        
                        animation.onfinish = () => confetti.remove();
                    }, i * 20);
                }
                
            }
            
            function updateParticipants() {
                const newCount = parseInt(participantsInput.value);
                if (newCount >= 10 && newCount <= 500) {
                    participants = newCount;
                    participantsInput.value = participants;
                    initializeRoulette();
                } else {
                    alert('Количество участников должно быть от 10 до 500');
                    participantsInput.value = participants;
                }
            }
            
            function addParticipants() {
                participants = Math.min(500, participants + 10);
                participantsInput.value = participants;
                initializeRoulette();
            }
            
            function removeParticipants() {
                participants = Math.max(10, participants - 10);
                participantsInput.value = participants;
                initializeRoulette();
            }
            
             function closeModal() {
                 winnerModal.classList.remove('active');
                 stopFireworks();
             }
             
             function addWinnerToList(winnerNumber) {
                 // Добавляем победителя с номером раунда
                 const winnerEntry = {
                     round: roundNumber,
                     number: winnerNumber
                 };
                 
                 winners.push(winnerEntry); // Добавляем в конец (новые раунды внизу)
                 
                 // Ограничиваем количество победителей (максимум 10)
                 if (winners.length > 10) {
                     winners = winners.slice(-10); // Оставляем последние 10
                 }
                 
                 updateWinnersPanel();
                 roundNumber++; // Увеличиваем номер раунда для следующего розыгрыша
             }
             
             function updateWinnersPanel() {
                 // Удаляем все элементы победителей (кроме заголовка)
                 const existingItems = winnersPanel.querySelectorAll('.winner-item');
                 existingItems.forEach(item => item.remove());
                 
                 // Если нет победителей, ничего не показываем
                 if (winners.length === 0) {
                     return;
                 }
                 
                 // Создаем элементы для каждого победителя
                 winners.forEach(winner => {
                     const winnerItem = document.createElement('div');
                     winnerItem.className = 'winner-item';
                     winnerItem.innerHTML = `
                         <span class="winner-text">${winner.round} раунд - №</span>
                         <span class="winner-number">${winner.number}</span>
                     `;
                     winnersPanel.appendChild(winnerItem);
                 });
             }
            
            function toggleFullscreen() {
                if (!document.fullscreenElement) {
                    if (document.documentElement.requestFullscreen) {
                        document.documentElement.requestFullscreen();
                    } else if (document.documentElement.webkitRequestFullscreen) {
                        document.documentElement.webkitRequestFullscreen();
                    } else if (document.documentElement.msRequestFullscreen) {
                        document.documentElement.msRequestFullscreen();
                    }
                } else {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                    } else if (document.webkitExitFullscreen) {
                        document.webkitExitFullscreen();
                    } else if (document.msExitFullscreen) {
                        document.msExitFullscreen();
                    }
                }
            }
            
            function updateFullscreenButton() {
                const isFullscreen = document.fullscreenElement || 
                                   document.webkitFullscreenElement || 
                                   document.msFullscreenElement;
                
                if (isFullscreen) {
                    fullscreenBtn.innerHTML = '⛶ Выйти';
                    fullscreenBtn.style.background = 'linear-gradient(180deg, #c0392b 0%, #a93226 100%)';
                } else {
                    fullscreenBtn.innerHTML = '⛶ Полный экран';
                    fullscreenBtn.style.background = 'linear-gradient(180deg, rgba(0,0,0,0.95) 0%, rgba(20,20,20,0.95) 100%)';
                }
            }
            
            spinBtn.addEventListener('click', startSpinning);
            stopBtn.addEventListener('click', stopSpinning);
            updateBtn.addEventListener('click', updateParticipants);
            addBtn.addEventListener('click', addParticipants);
            removeBtn.addEventListener('click', removeParticipants);
            closeModalBtn.addEventListener('click', closeModal);
            fullscreenBtn.addEventListener('click', toggleFullscreen);
            
            document.addEventListener('fullscreenchange', updateFullscreenButton);
            document.addEventListener('webkitfullscreenchange', updateFullscreenButton);
            document.addEventListener('msfullscreenchange', updateFullscreenButton);
            
            winnerModal.addEventListener('click', (e) => {
                if (e.target === winnerModal) {
                    closeModal();
                }
            });
            
            participantsInput.addEventListener('change', updateParticipants);
            
             initializeRoulette();
             updateFullscreenButton();
             updateWinnersPanel(); // Инициализируем пустой список победителей

            let fireworksIntervalId = null;
            function startFireworks() {
                if (fireworksIntervalId) return;
                fireworksIntervalId = setInterval(() => {
                    launchFirework();
                }, 1200);
            }
            
            function stopFireworks() {
                if (fireworksIntervalId) {
                    clearInterval(fireworksIntervalId);
                    fireworksIntervalId = null;
                }
            }
            
             function launchFirework() {
                 const cx = Math.random() * window.innerWidth * 0.7 + window.innerWidth * 0.15;
                 const cy = Math.random() * window.innerHeight * 0.4 + window.innerHeight * 0.2;
                 const colors = ['#ffffff', '#e74c3c', '#ff6b5a', '#f1c40f'];
                 // Уменьшаем количество частиц фейерверка для телевизоров
                 const particles = window.innerWidth > 1200 ? 8 : 15;
                for (let i = 0; i < particles; i++) {
                    const p = document.createElement('div');
                    p.className = 'firework-particle';
                    p.style.width = '10px';
                    p.style.height = '10px';
                    const color = colors[Math.floor(Math.random() * colors.length)];
                    p.style.background = color;
                    p.style.left = cx + 'px';
                    p.style.top = cy + 'px';
                    p.style.boxShadow = `0 0 12px ${color}`;
                    document.body.appendChild(p);
                    const angle = (Math.PI * 2 * i) / particles;
                    const distance = Math.random() * 220 + 120;
                    const tx = Math.cos(angle) * distance;
                    const ty = Math.sin(angle) * distance;
                    const duration = Math.random() * 1000 + 1200;
                    const keyframes = [
                        { transform: 'translate(0,0) scale(1)', opacity: 1 },
                        { transform: `translate(${tx}px, ${ty}px) scale(0.3)`, opacity: 0 }
                    ];
                    const anim = p.animate(keyframes, { duration, easing: 'cubic-bezier(0.2,0.6,0.2,1)' });
                    anim.onfinish = () => p.remove();
                }
            }

            const observer = new MutationObserver(() => {
                const active = winnerModal.classList.contains('active');
                if (active) {
                    startFireworks();
                } else {
                    stopFireworks();
                }
            });
            observer.observe(winnerModal, { attributes: true, attributeFilter: ['class'] });
        });
    </script>
</body>
</html>

